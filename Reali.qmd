---
title: "Test Data management"
author: "Tommaso Reali"
format: html
editor: visual
---


link to github repository: https://github.com/tommasoreali/grades-eval.git


#1

## Question 1

```{r}
library(readr)
library(dplyr)
library(here)
here::i_am("grades-eval.Rproj")
courses <- read_csv(here("courses.csv"))



```

## Question 2

```{r}
library(knitr)

courses %>%
  arrange(course) %>%
  kable()

```

## Question 3

```{r}
library(readr)
library(dplyr)
library(here)
students <- read_csv(here("students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_integer(),
    birth_date = col_date(format = ""),
    sex = col_factor()
  )
)

```

## Question 4

```{r}
library(tidyverse)

grades <- read_delim(
  "grades.csv",
  delim = ";",
  na = "$"
)

```
# 2 Student POpoulation analysis

## Question 5

```{r}
library(ggplot2)

students %>%
  count(group) %>%
  ggplot(aes(x = group, y = n)) +
  geom_col()
```

## Question 6

```{r}
students %>%
  count(group, sex) %>%
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_col()

```

## Question 7

```{r}
library(lubridate)

students <- students %>%
  mutate(
    age = time_length(today() - birth_date, unit = "year")
  )

ggplot(students, aes(x = age)) +
  geom_histogram(bins = 20)

```


## Question 8

```{r}
students %>%
  group_by(group) %>%
  summarise(median_age = round(median(age))) %>%
  knitr::kable()

```

## Question 9

```{r}
students %>%
  group_by(group) %>%
  slice_max(age, n = 1) %>% 
  ungroup() %>%
  select(id, sex, age, group) %>%
  arrange(desc(age)) %>%
  knitr::kable()
```
# 3 Simple grade analysis

## Question 10

```{r}
n_grades <- grades %>%
  filter(!is.na(grade)) %>%
  nrow()

n_grades
```
data set contains `r n_grades` grades

## Question 11

```{r}
egypt_id <- courses %>%
  filter(course == "Egyptian Mythology and Religion") %>%
  pull(course_id)

avg_egypt <- grades %>%
  filter(course_id == egypt_id, !is.na(grade)) %>%
  group_by(id) %>%
  summarise(mean_grade = mean(grade)) %>%
  inner_join(students, by = "id") %>%
  group_by(group) %>%
  summarise(average = mean(mean_grade))

ggplot(avg_egypt, aes(x = group, y = average)) +
  geom_col()

```

## Question 12

# 4 Attendance analysis

```{r}
grades_with_sem <- grades %>%
  inner_join(courses, by = "course_id")

ggplot(grades_with_sem, aes(x = factor(semester), y = grade)) +
  geom_boxplot()

```

boxplot comparison between the distribution of the grades of the 2 semesters


```{r}
ggplot(grades_with_sem, aes(x = grade, color = factor(semester))) +
  geom_density() +
  labs(color = "Semester")

```

density plot comparison

## Question 13

```{r}
grades_per_student <-
  grades |>
  filter(!is.na(grade)) |>
  summarise(
    n_grades = n(),
    .by = id
  ) |>
  left_join(
    students |>
      select(id, group, sex),
    by = "id"
  )

# dataset representation
grades_per_student |>
  slice_head(n = 5) |>
  kable()

# markdown table
grades_per_student |>
  summarise(
    min_grades    = min(n_grades),
    max_grades    = max(n_grades),
    mean_grades   = mean(n_grades),
    median_grades = median(n_grades)
  ) |>
  kable()
```


## Question 14

```{r}
library(ggplot2)

grades_per_student |>
  ggplot(aes(x = n_grades, fill = sex)) +
  geom_histogram(binwidth = 1, position = "dodge")
```

## Question 15

```{r}

alchemy_id <-
  courses |>
  filter(course == "Alchemy and Hermetic Philosophy") |>
  pull(course_id)

alchemy_counts <-
  grades |>
  filter(course_id == alchemy_id, !is.na(grade)) |>
  summarise(
    nb_grades = n(),
    .by = id
  )


students_alchemy <-
  students |>
  select(id, group) |>
  left_join(alchemy_counts, by = "id") |>
  mutate(
    nb_grades = if_else(is.na(nb_grades), 0L, nb_grades)
  )


students_alchemy |>
  slice_head(n = 5) |>
  kable()

```

## Question 16

```{r}

dist_alchemy <-
  students_alchemy |>
  summarise(
    n_students = n(),
    .by = nb_grades
  )

dist_alchemy |>
  kable()


dist_alchemy |>
  ggplot(aes(x = nb_grades, y = n_students)) +
  geom_col()

```


## Question 17 

```{r}
ggplot(students_alchemy, aes(x= factor(group), y= nb_grades)) +
  geom_jitter(width = 0.2, alpha =0.6) +
  labs(x = "Group",
       y= "Number of  grades in Alchemy and Hermetic Philosophy")

```


## Question 18

```{r}
ggplot(grades_per_student,
       aes(x = factor(group), y = n_grades, color = sex)) +
  geom_jitter(width = 0.2, alpha = 0.6) +
  labs(
    x = "Group",
    y = "nb of grades per student",
    color = "Sex"
  )


```

# 5 Grade analysis


computing average grade per course per student 

```{r}
avg_per_course <-
  grades %>%
  filter(!is.na(grade)) %>%
  summarise(mean_grade = mean(grade), .by = c(id, course_id)) %>%
  left_join(courses, by = "course_id")

```


## Question 19

```{r}
library(tidyr)

all_avg_wide <-
  avg_per_course %>%
  select(id, course, mean_grade) %>%
  pivot_wider(
    names_from = course,
    values_from = mean_grade
  ) %>%
  left_join(students %>% select(id, group), by = "id")

all_avg_wide %>%
  slice_head(n = 4) %>%
  knitr::kable()


```


## Question 20

```{r}
avg_two <-
  avg_per_course %>%
  filter(course %in% c("Alchemy and Hermetic Philosophy",
                       "Egyptian Mythology and Religion")) %>%
  left_join(students %>% select(id, group), by = "id") %>%
  summarise(
    avg = mean(mean_grade),
    .by = c(group, course)
  )

ggplot(avg_two, aes(x = group, y = avg, fill = course)) +
  geom_col(position = "dodge")

```

## Question 21

```{r}
two_courses <-
  all_avg_wide %>%
  select(`Alchemy and Hermetic Philosophy`,
         `Egyptian Mythology and Religion`) %>%
  na.omit()

cor(two_courses$`Alchemy and Hermetic Philosophy`,
    two_courses$`Egyptian Mythology and Religion`)
```

## Question 22

```{r}
avg_22 <-
  all_avg_wide %>%
  select(id, group,
         `Astrology and Celestial Navigation`,
         `Alchemy and Hermetic Philosophy`)


avg_22_long <-
  avg_22 %>%
  pivot_longer(
    cols = -c(id, group),
    names_to = "course",
    values_to = "mean_grade"
  )

ggplot(avg_22_long, aes(x = group, y = mean_grade, fill = course)) +
  geom_boxplot()

```

## question 23

```{r}

final_grades <-
  avg_per_course %>%
  summarise(final_grade = mean(mean_grade), .by = id) %>%
  left_join(students %>% select(id, group, sex), by = "id") %>%
  select(id, group, sex, final_grade) %>%
  arrange(desc(final_grade))

final_grades %>%
  slice_head(n = 5) %>%
  kable()

```

## Question 24

```{r}
ggplot(final_grades, aes(x= final_grade, color = group)) + 
  geom_density() +
  labs(x= "Final grade", y= "Density")
```

## Question 25

```{r}
ggplot(final_grades, aes(x=final_grade, color =sex)) +
  geom_density() +
  facet_wrap(~group)+
  labs(x= "Final grade", y = "Desnity")
```

## Qurstion 26

```{r}

```

## Question 27

```{r}

```

